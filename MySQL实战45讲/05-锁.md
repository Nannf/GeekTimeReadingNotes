### 锁

- 锁包括全局锁，表锁，行锁。粒度依次降低。
- 锁的出现类比java中的锁，因为数据库是一个共享的，对于共享数据的访问，我们有时因为一些业务需要同步操作。



#### 全局锁

顾名思义，全局锁是锁住整个数据库，只能读不能写。这个粒度最大，但是代价比较高。

##### 如何开启？

执行命令：Flush tables with read lock (FTWRL)。

所有的DML和DDL语句都会被阻塞。



##### 使用场景

1. 全库备份
   - 需要再备份的时候保证不会有变化。让全库只能读。
   - 如果备份主库，将导致业务停摆，如果备份备库，会导致主库和备库的逻辑不一致。不一致的原因是，主库发给备库的binlog，会被阻塞。导致主从延迟，如果用这个延迟的备份库来恢复系统数据，会导致数据的不一致性。这里我有一个疑问，binlog延迟又不是没有生成，为什么用这个已经生产的binlog恢复会导致数据不一致呢？我们考虑这样一个场景，我们的备份需要备份两张表，一张表存自己的账户余额，一张表存放自己购买的课程，当我们买课的时候，会有一个事务，就是课程表中新增一条记录，余额表中扣除课程的费用。这个在用户操作主库的时候一定是事务完成的。那就涉及一个问题，主从库是如何同步的？大致搜索了下[MySQL主从复制](https://blog.csdn.net/seven71111/article/details/109213684)

