本文的题目是mysql为什么有时候会选错索引呢？

这里有几个概念：

1. 有时候：偶尔发生，一定是触发了什么场景
2. 选错：对错是人为来判断，说明当有多个的时候，它选择的索引，和我们预期的索引不是一个索引。



通读一遍之后，总结几个点：

1. 索引是在优化器阶段选择的。

2. 索引的选择会考虑包括如下几个但不限于这几个

   1. 扫描行数

      - **扫描行数越少的索引会被选择**

      - 因为索引存在的目标就是在全表扫描的基础上少扫描一些行数而达到节省时间的目的
      - 但是这个是在实际执行前分析的，所以这是一个近似值，必然有一个计算每种索引会扫描多少行的一个粗略的估算方法。
        - **区分度**：索引上不同的值越多，区分度就越好
        - **基数**：一个索引上不同值的个数，我们称为基数
        - **基数计算方法**：采样统计，随机取几个索引数据页，然后从中计算出不同的索引值的个数，然后乘以索引的数据页总数，即可粗略的得到基数。
      - **analyze table t**，发现索引统计的行数和实际的有偏差可以使用这个语句修正

   2. 是否需要回表

      * **不需回表的索引会被选择**

   3. 是否需要排序

      - 假设有字段b，且建立的索引，且返回是按照b升序排序返回的，这会让mysql服务器觉得使用这个索引，自然就有序了，就无需排序了。





