

唯一索引保证b+树上的节点的值是唯一的；

这在查询上和修改上会带来什么样的影响呢？

现在的场景是库里的这个字段由业务端保证不会重复。

首先来看看查询：

> 当我们在二叉树上找到这个值的时候，因为唯一性，我们不会接着往后找，如果是普通索引，是会接着往后找的，读取索引树上的下一条数据，判断不是之后结束查找。

这个造成的性能损失了吗？且不论其他，这个仅增加了一次寻找的过程，二者的查询效率基本忽略不计。而且这次查找我们做了哪些事情呢？我们知道B+树索引上的叶子节点维护了相邻叶子节点的指针，这个指针有啥用呢？就是定位到相邻的叶子节点的物理地址。这里有个问题，就是所有的叶子节点是使用连续内存存储的吗？

我们知道InnoDB引擎维护磁盘的基本单位是页，一般是16k，读取的时候也是把16k全部读取进内存的，

数据库中最耗时的一种操作就是从磁盘上随机读取数据。

这里有个问题，就是b+数索引的叶子节点之间是顺序存储的吗，是存放在一个数据页上的吗。

这个我们先略过不提，我们只要知道，如果业务端保证了数据唯一性的情况下，在读取数据方面，唯一索引和普通索引差别不大。

这边引申出一个问题：

Q: b+树上的叶子节点是使用连续磁盘空间存储的吗？

A: 不是，因为不好评估叶子节点区间的大小，这个连续空间没办法设置，这种插入较多的，我们使用的也是链表的方式存储；二是B+树的非叶子节点上存放的是key，并不包含值，且不同的叶子节点之间使用引用连接，这样跨叶子节点的访问无需冲根节点重新定位。我们把自己想象成MySQL的服务器，当我们要读取一个id=5的数据，我们第一步就是到索引树去找这个5的数据，我们在B+数上，找到了区间3开头的，我们逐个获取这个叶子节点上的数据，直到获取到5为止，如果是唯一索引就到此结束，如果不是，就需要接着访问下一个，如果跨页了，我们就需要在从磁盘上捞一页的数据上来，这个发生的机率不高，而且数量只有一次，时间基本可以忽略不计。



[索引相关，指出了区间搜索](https://blog.csdn.net/qq_33599978/article/details/78368660)



再来看看更新，这边要介绍到一个新的概念**change buffer**

#### changebuffer 是什么

是一个内存中的文件，当我们对数据进行改动的时候，**为了速度**，我们会把改动先记录在内存中，每次读取的时候，我们把磁盘上的记录和changebuffer中的做一次运算，就得到一个最新的结果集。**为了可用性**，我们需要把changebuffer存放在内存中，如果数据库是正常关闭的，我们会把changebuffer中的数据同步到磁盘上，如果是非正常关闭呢？这个和redolog，binlog是如何联动的呢？这个我们略过不表。

这边引申出一个问题：

Q： changebuffer 和 redolog binlog 是如何联动的呢?



Q : 唯一索引能使用changebuffer吗？