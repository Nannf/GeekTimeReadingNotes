#### 前言

我们要怎么判断一个数据库是不是正常在运行呢? 

我们为什么要问这个问题呢？因为主备切换主要发生在HA系统检测到主库出问题了的时候主动发生的切换。



我觉得是要对这个正常的边界进行一个明确。



读完本章之后发现就是这个边界的问题，导致了不同的判断方式。



#### 主库进程还在，就是好的

select 就是在这个边界下产生的。

我们看如下的一段sql序列

```mysql
set global innodb_thread_concurrency=3;

CREATE TABLE `t` (
  `id` int(11) NOT NULL,
  `c` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB;

 insert into t values(1,1)
```

![img](https://static001.geekbang.org/resource/image/35/55/35076dd3d0a0d44d22b76d2a29885255.png)

###### innodb_thread_concurrency

这个参数控制的是innodb并发线程的上限。当达到这个上限的时候，如果服务器接收到新的查询请求，会被放到等待队列，直到有查询线程返回。



