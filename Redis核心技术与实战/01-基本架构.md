#### 关键词

- 系统观
- SimpleKV
- 内存 or 磁盘
- 性能 or 可靠性
- IO模型
- 持久化



初读之下，不太适应作者的表述方式。

我试着通过一些关键词来串联作者的行文思路，现在基于这些关键词，我复述下对本文我学到的东西。



- 作者先是提出了系统观的重要性，其实就是明确我们的学习的边界在哪，以及为什么边界是在那。
- 作者并没有上来就给出redis的架构图，出于简单性考虑，给出了一个基本的键值数据库SimpleKV应该具有的功能
- 常见的关系型数据库，如mysql中，如果我们按照一个字段来进行查找的时候，就是键值查询。所以键值查询是关系型操作的一个子集。键值查询对关系型操作的功能进行了精简。精简的动力是快，除了对功能进行精简外，还把操作改成了内存操作。
- 内存的速度远高于磁盘，但是容量却比磁盘低不少，这就意味着内存无法全部加载磁盘的所有数据，就意味着缓存淘汰和命中率的问题。
- 内存和磁盘的另一个区别是，内存数据断电就丢失了，这就有两个问题，一是内存中的数据也很多，这个重新加载需要很久，二是，我们上面说的涉及到淘汰和命中的问题，这些热点数据是随着客户的访问习惯而累积调教的，没有一个固定的加载算法，所以做到断电重启后之前调教好的数据还能存在是很必要的。
- 如果要做到断电重启后，数据还能保存就意味着我们要进行落盘操作，落盘会影响性能，但是落盘又是极其必要的。所以如何进行高效的持久化，在性能和可靠性之间达到一个平衡。



分析到这一步，我们明白了，在已有的关系型数据库的基础上，我们因为快，需要引入了内存数据库。而且是内存数据库中的键值数据库。

引入内存之后，我们如何高效的存储并操作数据需要相应数据结构的支持。类似于关系型数据库，需要有索引模块。索引模块的功能就是能够定位。

定位到要操作的位置之后，无法就是查询和写或者删，改内存中的数据。

因为内存中的数据并不是可以简单的按照某个查询逻辑就可以完成加载的，是随着不同的客户的使用习惯而生成的，但是由于内存的断电丢失数据，我们必须要有一个持久化数据到磁盘，以及加载磁盘数据到内存的模块。



但是我们的键值数据库是给别人使用的，需要告诉别人如何才能使用我们，这就需要一个访问控制模块，这一步就是管理连接，约定传输协议。

连接上之后，我们屏蔽了底层的操作细节，需要暴露给上层一些简单的操作接口，一般就是增删改查。这些都是协议的一部分，我们在接收到别人发送的这些语句之后，我们可以正确的解析并 转换成我们可以本身可以识别的指令集完成相应的操作。

我们需要有个模块专门负责进行这种语义的解析和转换。



![img](https://static001.geekbang.org/resource/image/30/44/30e0e0eb0b475e6082dd14e63c13ed44.jpg)





总结几个关键点

- 访问模块
  - 这个主要是完成http网络协议的编解码，解决传输过程中的粘包半包问题；
  - 已经i/o模型，常见的是基于事件驱动的reactor模型
  - 和netty很像，感觉网络编程遇到的问题就是这些
- 请求解析模块
  - 这个类似mysql中的分析器，和执行器，主要是解析http的请求内容，然后调用下面的数据存储模块提供的操作数据的接口返回数据
- 存储模块
  - 对数据进行索引
  - 对外面暴露操作数据的接口

