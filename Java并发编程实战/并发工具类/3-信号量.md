#### 概览

信号量机制其实跟管程是一样的，是解决对共享数据进行并发安全访问的一种机制。

信号量和管程最大的区别是，信号量可以很容易实现多个线程对一段临界区进行并发访问。

实现机制是：

- 计数器，这个主要表示最多有多少个线程可以对临界区进行访问
- 获取令牌： 线程只有获取到令牌之后才能进入临界区，同时会把计数器的值减一，当发现计数器的值是负数时，当前线程会在队列中阻塞（WAITING），接受调度
- 释放令牌：当线程执行完之后，释放自己的令牌，同时把计数器的值加一，此时无论计数器的值是正是负，我觉得都应该唤醒阻塞队列中的线程，其实如果是正的，阻塞队列中不应该有线程的。所以我们只有在计数器为0或者负值的时候，我们从阻塞队列中获取到一个阻塞线程，从等待队列中移除该线程，并把它唤醒。
- 其中获取和释放都是硬件级别保证的原子操作。



#### 信号量的可见性保证

仍然是volatile关键字。

仍然是state字段。

由此看来出自Doug Lea之手的并发包的所有可见性的保证都是volatile的happens-before原则。





#### 信号量的存在必要性

当需要多个线程对一个临界区的资源进行访问时。

常见的池化资源，数据库连接池，http连接池等。





