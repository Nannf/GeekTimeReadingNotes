并发的问题本质上就是会有修改操作。

如果我的变量是不可变的，唉，我不让你修改。此时是不是就能并发问题了。



#### 不可变的定义

- 针对的是对象
- 对象可变的都是属性，即状态
- 不可变指的是一旦一个对象被创建出来之后，它的状态就不可以改变。





#### 如何实现不可变类

- 属性全是final
- 只存在读取方法（List这些还是可以修改的）
- final修饰-防止子类继承，重写方法



#### 不可变如何提高修改方法

- 返回另一个对象给他



#### 享元模式

- 一些经常使用的值会缓存起来，这样当我们需要创建这些对象的时候，会先去判断是否已经存在了，如果已经存在，让引用的地址指向那个已存在的对象的指针就行了
- 这样做的目的是因为一些值的出现概率很大，可以节省很多的内存空间
- 会导致的问题
  - synchronized的对象不适宜使用String、Integer这些有享元模式的对象
  - 因为看着都是新变量，但是实际上是一个。



#### 注意试想

- final如果不到每个基本变量，无法保证不变性

```java
class Foo {
    int age;
    String name;
}

class Bar {
    final Foo foo;
    
    void setAge(int age) {
        foo.age = age;
    }
}
```

